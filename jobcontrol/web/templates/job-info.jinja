{% extends 'base.jinja' %}

{% block page_title %}Job {{ job['id'] }}{% endblock %}

{% block page_body %}
<div class="container-fluid">
  <h1>Job {{ job['id'] }}</h1>

  <div class="btn-group" style="margin-bottom:10px;">
    <a href="{{ url_for('webui.job_edit', job_id=job['id']) }}" class="btn btn-default">
      <span class="glyphicon glyphicon-edit"></span>
      Edit</a>
    <a href="{{ url_for('webui.job_run', job_id=job['id']) }}" class="btn btn-default">
      <span class="glyphicon glyphicon-cog"></span>
      Run</a>
    <a href="{{ url_for('webui.job_delete', job_id=job['id']) }}" class="btn btn-default">
      <span class="glyphicon glyphicon-trash"></span>
      Delete</a>
  </div>

  <table class="table table-bordered">
    <tr>
      <th>Function</th>
      <td>
	<code>{{ job['function'] }}</code>
      </td>
    </tr>
    <tr>
      <th>Arguments</th>
      <td>
	<code>{{ job['args'] }}</code>
      </td>
    </tr>
    <tr>
      <th>Keyword arguments</th>
      <td>
	<code>{{ job['kwargs'] }}</code>
      </td>
    </tr>
    <tr>
      <th>Created</th>
      <td>{{ job['ctime'] }}</td>
    </tr>
    <tr>
      <th>Updated</th>
      <td>{{ job['mtime'] or 'Never' }}</td>
    </tr>
    <tr>
      <th>Dependencies</th>
      <td>
	  {% for dep in job['dependencies'] %}
	    <a href="{{ url_for('webui.job_info', job_id=dep) }}" class="btn btn-default">
	      {{ dep }}
	    </a>
	  {% endfor %}
      </td>
    </tr>
  </table>

  <h2>Builds</h2>

  <table class="table table-bordered table-hover table-striped">
    <thead>
      <tr>
        <th>Job id</th>
        <th>Build id</th>
        <th>Start time</th>
        <th>End time</th>
        <th>Started</th>
        <th>Finished</th>
        <th>Success</th>
        <th>Skipped</th>
        <th>Progress</th>
        <th>Return value</th>
        <th>Exception</th>
      </tr>
    </thead>
    <tbody>
      {% for build in builds %}
	{% if build['finished'] %}
	  {% if build['skipped'] %}
	    {% set row_class = 'warning' %}
	  {% elif build['success'] %}
	    {% set row_class = 'success' %}
	  {% else %}
	    {% set row_class = 'danger' %}
	  {% endif %}
	{% else %}
	  {% set row_class = '' %}
	{% endif %}
	<tr class="{{ row_class }}">
	  <td>{{ build['job_id'] }}</td>
	  <td>{{ build['id'] }}</td>
	  <td>{{ build['start_time'] }}</td>
	  <td>{{ build['end_time'] }}</td>

	  <td class="{% if build.started %}success{% else %}danger{% endif %}">
	    {{ build['started'] }}</td>

	  <td class="{% if build.finished %}success{% else %}warning{% endif %}">
	    {{ build['finished'] }}</td>

	  {% if build.finished %}
	  <td class="{% if build.success %}success{% else %}danger{% endif %}">
	    {{ build['success'] }}</td>
	  {% else %}
	    <td>N/A</td>
	  {% endif %}

	  <td class="{% if build.skipped %}warning{% else %}success{% endif %}">
	    {{ build['skipped'] }}</td>

	  <td>
	    <div class="progress progress-striped {% if build.progress_pc_n < 100 %}active{% endif %}"
		 style="min-width: 200px">
	      <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: {{ build['progress_pc'] }}%;">
		{{ build['progress'] }}
	      </div>
	    </div>
	  </td>
	  <td><code>{{ build['retval'] }}</code></td>
	  <td>{{ build['exception'] or '' }}</td>
	</tr>
      {% endfor %}
    </tbody>
  </table>

</div>
{% endblock %}
